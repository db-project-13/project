{% extends "layout/base.html" %} {% block title %}{{ content.title }} -
Team13-Phase4{% endblock %} {% block content %}
<div class="row">
  <div class="col-12">
    <h2 class="mb-4">{{ content.title }}</h2>

    <!-- ì½˜í…ì¸  ê¸°ë³¸ ì •ë³´ -->
    <div class="card mb-4">
      <div class="card-body">
        <dl class="row">
          <dt class="col-sm-3">ì¶œì‹œì¼</dt>
          <dd class="col-sm-9">{{ content.releasedate }}</dd>

          <dt class="col-sm-3">ì œì‘ì‚¬</dt>
          <dd class="col-sm-9">
            {{ content.prodname }} {% if content.prodinfo %}
            <br /><small class="text-muted">{{ content.prodinfo }}</small>
            {% endif %}
          </dd>

          {% if content.sname %}
          <dt class="col-sm-3">ì‹œë¦¬ì¦ˆ</dt>
          <dd class="col-sm-9">{{ content.sname }}</dd>
          {% endif %}
        </dl>

        <!-- íƒœê·¸ ì •ë³´ -->
        {% if tags_by_category %}
        <div class="mb-3">
          <strong>íƒœê·¸:</strong>
          {% for category, tags in tags_by_category.items() %}
          <span class="badge bg-secondary me-1"
            >{{ category }}: {{ tags }}</span
          >
          {% endfor %}
        </div>
        {% endif %}

        <!-- êµ¬ë§¤ì²˜ ì •ë³´ -->
        {% if shops %}
        <div class="mb-3">
          <strong>êµ¬ë§¤ì²˜:</strong>
          {% for shop in shops %}
          <a
            href="{{ shop.main_url }}{{ shop.sub_url }}"
            target="_blank"
            class="btn btn-sm btn-outline-primary me-1"
          >
            {{ shop.main_url }}
          </a>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </div>

    <!-- ë¦¬ë·° í†µê³„ -->
    {% if stats.reviewcount > 0 %}
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">ë¦¬ë·° í†µê³„</h5>
        <div class="row">
          <div class="col-md-3">
            <h3 class="text-primary">{{ stats.avgrating }}</h3>
            <p class="text-muted">í‰ê·  í‰ì  ({{ stats.reviewcount }}ê°œ ë¦¬ë·°)</p>
          </div>
          <div class="col-md-9">
            <div class="mb-2">
              <small>5ì : {{ stats.rating5 }}ê°œ</small>
              <div class="progress" style="height: 20px">
                <div
                  class="progress-bar"
                  role="progressbar"
                  style="width: {% if stats.reviewcount > 0 %}{{ (stats.rating5 / stats.reviewcount * 100) }}{% else %}0{% endif %}%"
                ></div>
              </div>
            </div>
            <div class="mb-2">
              <small>4ì : {{ stats.rating4 }}ê°œ</small>
              <div class="progress" style="height: 20px">
                <div
                  class="progress-bar bg-success"
                  role="progressbar"
                  style="width: {% if stats.reviewcount > 0 %}{{ (stats.rating4 / stats.reviewcount * 100) }}{% else %}0{% endif %}%"
                ></div>
              </div>
            </div>
            <div class="mb-2">
              <small>3ì : {{ stats.rating3 }}ê°œ</small>
              <div class="progress" style="height: 20px">
                <div
                  class="progress-bar bg-info"
                  role="progressbar"
                  style="width: {% if stats.reviewcount > 0 %}{{ (stats.rating3 / stats.reviewcount * 100) }}{% else %}0{% endif %}%"
                ></div>
              </div>
            </div>
            <div class="mb-2">
              <small>2ì : {{ stats.rating2 }}ê°œ</small>
              <div class="progress" style="height: 20px">
                <div
                  class="progress-bar bg-warning"
                  role="progressbar"
                  style="width: {% if stats.reviewcount > 0 %}{{ (stats.rating2 / stats.reviewcount * 100) }}{% else %}0{% endif %}%"
                ></div>
              </div>
            </div>
            <div class="mb-2">
              <small>1ì : {{ stats.rating1 }}ê°œ</small>
              <div class="progress" style="height: 20px">
                <div
                  class="progress-bar bg-danger"
                  role="progressbar"
                  style="width: {% if stats.reviewcount > 0 %}{{ (stats.rating1 / stats.reviewcount * 100) }}{% else %}0{% endif %}%"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- ë¦¬ë·° ì‘ì„± ë²„íŠ¼ -->
    <div class="mb-3">
      {% if session.get('user_id') %} {% if user_review %}
      <a
        href="{{ url_for('content.update_review', content_id=content.contentid) }}"
        class="btn btn-warning"
        >ë¦¬ë·° ìˆ˜ì •</a
      >
      <form
        method="POST"
        action="{{ url_for('content.delete_review', content_id=content.contentid) }}"
        class="d-inline"
        onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');"
      >
        <button type="submit" class="btn btn-danger">ë¦¬ë·° ì‚­ì œ</button>
      </form>
      {% else %}
      <a
        href="{{ url_for('content.create_review', content_id=content.contentid) }}"
        class="btn btn-primary"
        >ë¦¬ë·° ì‘ì„±</a
      >
      {% endif %} {% else %}
      <a href="{{ url_for('auth.login') }}" class="btn btn-outline-primary"
        >ë¡œê·¸ì¸ í›„ ë¦¬ë·° ì‘ì„±</a
      >
      {% endif %}
    </div>

    <!-- ë¦¬ë·° ëª©ë¡ -->
    <h3 class="mb-3">ë¦¬ë·° ëª©ë¡</h3>
    {% if reviews %} {% for review in reviews %}
    <div class="card mb-2">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <h5 class="card-title mb-1">{{ review.membername }}</h5>

            <!-- ë³„ì  í‘œì‹œ -->
            <div class="mb-2">
              {% for i in range(1, 6) %} {% if i <= review.rating %}
              <span class="text-warning">â˜…</span>
              {% else %}
              <span class="text-muted">â˜†</span>
              {% endif %} {% endfor %}
              <span class="badge bg-primary ms-2">{{ review.rating }}/5</span>
            </div>

            <!-- ì½”ë©˜íŠ¸ -->
            {% if review.comm %}
            <p class="card-text">{{ review.comm }}</p>
            {% else %}
            <p class="card-text text-muted"><em>ì½”ë©˜íŠ¸ ì—†ìŒ</em></p>
            {% endif %}

            <!-- ì¢‹ì•„ìš” ê°œìˆ˜ + ë²„íŠ¼ -->
            <div class="mt-2">
              <small class="text-muted me-2">
                ğŸ‘ ì¢‹ì•„ìš”: {{ review.likes or 0 }}
              </small>

              {% if user_id and user_id != review.memberid %}
              <form
                method="POST"
                action="{{ url_for('content.like_review',
                                                           content_id=content.contentid,
                                                           review_member_id=review.memberid) }}"
                class="d-inline"
              >
                <button type="submit" class="btn btn-sm btn-outline-primary">
                  ì¢‹ì•„ìš”
                </button>
              </form>
              {% endif %}
            </div>
          </div>

          <!-- ë‚´ê°€ ì“´ ë¦¬ë·°ì¼ ë•Œë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ -->
          {% if review.memberid == user_id %}
          <div>
            <a
              href="{{ url_for('content.update_review', content_id=content.contentid) }}"
              class="btn btn-sm btn-outline-warning"
              >ìˆ˜ì •</a
            >
            <form
              method="POST"
              action="{{ url_for('content.delete_review', content_id=content.contentid) }}"
              class="d-inline"
              onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');"
            >
              <button type="submit" class="btn btn-sm btn-outline-danger">
                ì‚­ì œ
              </button>
            </form>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %} {% else %}
    <div class="alert alert-info" role="alert">
      ì•„ì§ ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
